# ===============================================
# CORS MULTI-PROYECTOS + MIRADOR LOS VOLCANES
# Soporte para múltiples aplicaciones React + PDF Viewer
# ===============================================

<IfModule mod_headers.c>
    # CRÍTICO: Limpiar headers heredados del padre
    Header unset Access-Control-Allow-Origin
    Header unset Access-Control-Allow-Methods
    Header unset Access-Control-Allow-Headers
    Header unset Access-Control-Max-Age

    # Para archivos del tour y PDFs
    <FilesMatch "\.(jpg|jpeg|png|xml|js|swf|pdf)$">
        # Detectar origen y establecer variable para cada proyecto
        SetEnvIf Origin "^http://localhost:5173$" CORS_ORIGIN=http://localhost:5173
        SetEnvIf Origin "^http://localhost:5174$" CORS_ORIGIN=http://localhost:5174
        SetEnvIf Origin "^https://reserva-martin-pescador\.onrender\.com$" CORS_ORIGIN=https://reserva-martin-pescador.onrender.com
        SetEnvIf Origin "^https://fundo-la-dehesa\.onrender\.com$" CORS_ORIGIN=https://fundo-la-dehesa.onrender.com
        SetEnvIf Origin "^https://godai-reserve\.onrender\.com$" CORS_ORIGIN=https://godai-reserve.onrender.com
        SetEnvIf Origin "^https://el-americano\.onrender\.com$" CORS_ORIGIN=https://el-americano.onrender.com
        SetEnvIf Origin "^https://trebol-loteadora\.onrender\.com$" CORS_ORIGIN=https://trebol-loteadora.onrender.com
        SetEnvIf Origin "^https://mirador-los-volcanes\.onrender\.com$" CORS_ORIGIN=https://mirador-los-volcanes.onrender.com
        
        # Aplicar headers CORS solo si hay origen válido
        Header always set Access-Control-Allow-Origin "%{CORS_ORIGIN}e" env=CORS_ORIGIN
        Header always set Access-Control-Allow-Methods "GET, HEAD, OPTIONS" env=CORS_ORIGIN
        Header always set Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Range" env=CORS_ORIGIN
        Header always set Access-Control-Max-Age "86400" env=CORS_ORIGIN
        Header always set Accept-Ranges "bytes" env=CORS_ORIGIN
    </FilesMatch>
</IfModule>

# Preflight requests para todos los proyectos incluyendo PDFs
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_METHOD} OPTIONS
    RewriteCond %{REQUEST_URI} \.(jpg|jpeg|png|xml|js|swf|pdf)$ [NC]
    RewriteRule ^(.*)$ - [R=200,L]
</IfModule>

# Cache optimizado incluyendo PDFs
<IfModule mod_expires.c>
    ExpiresActive On
    <FilesMatch "\.(jpg|jpeg|png)$">
        ExpiresDefault "access plus 7 days"
    </FilesMatch>
    <FilesMatch "\.(xml|js)$">
        ExpiresDefault "access plus 1 hour"
    </FilesMatch>
    <FilesMatch "\.(pdf)$">
        ExpiresDefault "access plus 1 day"
    </FilesMatch>
</IfModule>